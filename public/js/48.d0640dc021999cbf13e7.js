(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{"+wBV":function(t,a,e){"use strict";var i=e("eFYJ");e.n(i).a},eFYJ:function(t,a,e){var i=e("lun+");"string"==typeof i&&(i=[[t.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};e("aET+")(i,o);i.locals&&(t.exports=i.locals)},"lun+":function(t,a,e){(t.exports=e("I1BE")(!1)).push([t.i,'[data-v-b91da14a]:root{--color-text-primary:#fff;--color-text-secondary:hsla(0,0%,100%,0.7);--color-bg-primary:#181818;--color-bg-secondary:hsla(0,0%,100%,0.025);--color-highlight:#ff7d2e;--bg-image:none;--bg-position:center;--bg-attachment:fixed;--bg-size:cover;--font-family:system,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;--font-weight-thin:100;--font-weight-light:300;--font-weight-normal:500;--header-height:48px;--footer-height:64px;--footer-height-mobile:74px;--extra-panel-width:334px;--color-black:#181818;--color-maroon:#bf2043;--color-green:#56a052;--color-blue:#0191f7;--color-red:#c34848}:root[data-theme=violet][data-v-b91da14a]{--color-bg-primary:#31094e}:root[data-theme=oak][data-v-b91da14a]{--color-bg-primary:#560d25}:root[data-theme=slate][data-v-b91da14a]{--color-bg-primary:#29434e}:root[data-theme=madison][data-v-b91da14a]{--color-bg-primary:#0e3463;--color-highlight:#fbab18}:root[data-theme=astronaut][data-v-b91da14a]{--color-bg-primary:#2a3074}:root[data-theme=chocolate][data-v-b91da14a]{--color-bg-primary:#3f2724}:root[data-theme=laura][data-v-b91da14a]{--color-bg-primary:#126673;--color-highlight:rgba(10,244,255,0.64)}:root[data-theme=rose-petals][data-v-b91da14a]{--bg-image:url(/img/themes/bg-rose-petals.svg);--color-bg-primary:#7d083b}:root[data-theme=purple-waves][data-v-b91da14a]{--color-bg-primary:#44115c;--bg-image:url(/img/themes/bg-purple-waves.svg)}:root[data-theme=cat][data-v-b91da14a]{--bg-image:url(/img/themes/bg-cat.jpg);--bg-position:left;--color-bg-primary:#000}:root[data-theme=pop-culture][data-v-b91da14a]{--bg-image:url(/img/themes/bg-pop-culture.jpg);--color-bg-primary:#ad0937;--color-highlight:rgba(234,208,110,0.9)}:root[data-theme=jungle][data-v-b91da14a]{--bg-image:url(/img/themes/bg-jungle.jpg);--color-bg-primary:#0f0f03}:root[data-theme=mountains][data-v-b91da14a]{--bg-image:url(/img/themes/bg-mountains.jpg);--color-bg-primary:#0e2656}:root[data-theme=pines][data-v-b91da14a]{--bg-image:url(/img/themes/bg-pines.jpg);--color-bg-primary:#06090c;--color-highlight:#5984b9}:root[data-theme=nemo][data-v-b91da14a]{--bg-image:url(/img/themes/bg-nemo.jpg);--color-bg-primary:#031724}form .tabs[data-v-b91da14a]{padding:0}form>header img[data-v-b91da14a]{flex:0 0 96px}form>header .meta[data-v-b91da14a]{flex:1;padding-left:1rem}form>header .meta .mixed[data-v-b91da14a]{opacity:.5}',""])},oymW:function(t,a,e){"use strict";e.r(a);var i=e("9EAu"),o=e("ilaN"),r=e("mboD"),s=e("c8RX"),n=e("JspL"),l=function(t,a,e,i){return new(e||(e=Promise))((function(o,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function n(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var a;t.done?o(t.value):(a=t.value,a instanceof e?a:new e((function(t){t(a)}))).then(s,n)}l((i=i.apply(t,a||[])).next())}))};const m=0,d=1,c=2;var u=n.a.extend({components:{Btn:()=>e.e(0).then(e.bind(null,"i0GK")),SoundBar:()=>e.e(2).then(e.bind(null,"yt5i")),Typeahead:()=>e.e(55).then(e.bind(null,"5Mty"))},props:{songs:{required:!0,type:[Array,Object]},initialTab:{type:String,default:"details",validator:t=>["details","lyrics"].includes(t)}},data:()=>({mutatedSongs:[],currentView:"",loading:!0,artistState:s.b.state,artistTypeAheadConfig:{displayKey:"name",filterKey:"name",name:"artist"},albumState:s.a.state,albumTypeAheadConfig:{displayKey:"name",filterKey:"name",name:"album"},formData:{title:"",albumName:"",artistName:"",lyrics:"",track:null,compilationState:0},initialFormData:null}),computed:{editingOnlyOneSong(){return 1===this.mutatedSongs.length},allSongsAreFromSameArtist(){return this.mutatedSongs.every(t=>t.artist.id===this.mutatedSongs[0].artist.id)},allSongsAreInSameAlbum(){return this.mutatedSongs.every(t=>t.album.id===this.mutatedSongs[0].album.id)},coverUrl(){return this.allSongsAreInSameAlbum?this.mutatedSongs[0].album.cover:Object(o.k)()},compilationState(){const t=this.mutatedSongs.reduce((t,a)=>Object(i.union)(t,[a.album]),[]),a=t.filter(t=>t.is_compilation);return a.length?a.length===t.length?this.formData.compilationState=d:this.formData.compilationState=c:this.formData.compilationState=m,this.formData.compilationState},displayedTitle(){return this.editingOnlyOneSong?this.formData.title:this.mutatedSongs.length+" songs selected"},displayedArtistName(){return this.allSongsAreFromSameArtist||this.formData.artistName?this.formData.artistName:"Mixed Artists"},displayedAlbumName(){return this.allSongsAreInSameAlbum||this.formData.albumName?this.formData.albumName:"Mixed Albums"},isPristine(){return Object(i.isEqual)(this.formData,this.initialFormData)}},methods:{open(){return l(this,void 0,void 0,(function*(){if(this.mutatedSongs=[].concat(this.songs),this.currentView=this.initialTab,this.editingOnlyOneSong)if(this.formData.title=this.mutatedSongs[0].title,this.formData.albumName=this.mutatedSongs[0].album.name,this.formData.artistName=this.mutatedSongs[0].artist.name,this.mutatedSongs[0].infoRetrieved)this.loading=!1,this.formData.lyrics=Object(o.d)(this.mutatedSongs[0].lyrics),this.formData.track=this.mutatedSongs[0].track||null,this.initCompilationStateCheckbox();else{this.loading=!0;try{yield r.c.fetch(this.mutatedSongs[0]),this.formData.lyrics=Object(o.d)(this.mutatedSongs[0].lyrics),this.formData.track=this.mutatedSongs[0].track||null}catch(t){console.error(t)}finally{this.loading=!1,this.initCompilationStateCheckbox()}}else this.formData.albumName=this.allSongsAreInSameAlbum?this.mutatedSongs[0].album.name:"",this.formData.artistName=this.allSongsAreFromSameArtist?this.mutatedSongs[0].artist.name:"",this.loading=!1,this.initCompilationStateCheckbox()}))},initCompilationStateCheckbox(){this.$nextTick(()=>{const t=this.$refs.compilationStateChk;switch(this.compilationState){case d:t.checked=!0,t.indeterminate=!1;break;case m:t.checked=!1,t.indeterminate=!1;break;default:t.checked=!1,t.indeterminate=!0}})},changeCompilationState(){const t=this.$refs.compilationStateChk;this.formData.compilationState=t.checked?d:m},close(){this.$emit("close")},maybeClose(){this.isPristine?this.close():o.b.confirm("Discard all changes?",()=>this.close())},submit(){return l(this,void 0,void 0,(function*(){this.loading=!0;try{yield s.l.update(this.mutatedSongs,this.formData),this.close()}finally{this.loading=!1}}))}},created(){return l(this,void 0,void 0,(function*(){yield this.open(),this.initialFormData=Object.assign({},this.formData)}))}}),h=(e("+wBV"),e("KHd+")),g=Object(h.a)(u,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"edit-song",attrs:{"data-testid":"edit-song-form",tabindex:"0"},on:{keydown:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"esc",27,a.key,["Esc","Escape"])?null:t.maybeClose(a)}}},[t.loading?e("sound-bar"):e("form",{on:{submit:function(a){return a.preventDefault(),t.submit(a)}}},[e("header",[e("img",{attrs:{src:t.coverUrl,width:"96",height:"96",alt:"Album's cover"}}),t._v(" "),e("hgroup",{staticClass:"meta"},[e("h1",{class:{mixed:!t.editingOnlyOneSong}},[t._v(t._s(t.displayedTitle))]),t._v(" "),e("h2",{class:{mixed:!t.allSongsAreFromSameArtist&&!t.formData.artistName}},[t._v(t._s(t.displayedArtistName))]),t._v(" "),e("h2",{class:{mixed:!t.allSongsAreInSameAlbum&&!t.formData.albumName}},[t._v(t._s(t.displayedAlbumName))])])]),t._v(" "),e("div",{staticClass:"tabs"},[e("div",{staticClass:"clear",attrs:{role:"tablist"}},[e("button",{attrs:{"aria-selected":"details"===t.currentView,"aria-controls":"editSongPanelDetails",id:"editSongTabDetails",role:"tab"},on:{click:function(a){a.preventDefault(),t.currentView="details"}}},[t._v("\n          Details\n        ")]),t._v(" "),t.editingOnlyOneSong?e("button",{attrs:{"aria-selected":"lyrics"===t.currentView,"aria-controls":"editSongPanelLyrics",id:"editSongTabLyrics",role:"tab","data-testid":"edit-song-lyrics-tab"},on:{click:function(a){a.preventDefault(),t.currentView="lyrics"}}},[t._v("\n          Lyrics\n        ")]):t._e()]),t._v(" "),e("div",{staticClass:"panes"},[e("div",{directives:[{name:"show",rawName:"v-show",value:"details"===t.currentView,expression:"currentView === 'details'"}],attrs:{"aria-labelledby":"editSongTabDetails",id:"editSongPanelDetails",role:"tabpanel",tabindex:"0"}},[t.editingOnlyOneSong?e("div",{staticClass:"form-row"},[e("label",[t._v("Title")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.title,expression:"formData.title"},{name:"koel-focus",rawName:"v-koel-focus"}],attrs:{title:"Title",name:"title",type:"text"},domProps:{value:t.formData.title},on:{input:function(a){a.target.composing||t.$set(t.formData,"title",a.target.value)}}})]):t._e(),t._v(" "),e("div",{staticClass:"form-row"},[e("label",[t._v("Artist")]),t._v(" "),e("typeahead",{attrs:{items:t.artistState.artists,config:t.artistTypeAheadConfig},model:{value:t.formData.artistName,callback:function(a){t.$set(t.formData,"artistName",a)},expression:"formData.artistName"}})],1),t._v(" "),e("div",{staticClass:"form-row"},[e("label",[t._v("Album")]),t._v(" "),e("typeahead",{attrs:{items:t.albumState.albums,config:t.albumTypeAheadConfig},model:{value:t.formData.albumName,callback:function(a){t.$set(t.formData,"albumName",a)},expression:"formData.albumName"}})],1),t._v(" "),e("div",{staticClass:"form-row"},[e("label",{staticClass:"small"},[e("input",{ref:"compilationStateChk",attrs:{type:"checkbox",name:"is_compilation"},on:{change:t.changeCompilationState}}),t._v("\n              Album is a compilation of songs by various artists\n            ")])]),t._v(" "),t.editingOnlyOneSong?e("div",{staticClass:"form-row"},[e("label",[t._v("Track")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.track,expression:"formData.track"}],attrs:{name:"track",type:"text",pattern:"\\d*",title:"Empty or a number"},domProps:{value:t.formData.track},on:{input:function(a){a.target.composing||t.$set(t.formData,"track",a.target.value)}}})]):t._e()]),t._v(" "),t.editingOnlyOneSong?e("div",{directives:[{name:"show",rawName:"v-show",value:"lyrics"===t.currentView,expression:"currentView === 'lyrics'"}],attrs:{"aria-labelledby":"editSongTabLyrics",id:"editSongPanelLyrics",role:"tabpanel",tabindex:"0"}},[e("div",{staticClass:"form-row"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.lyrics,expression:"formData.lyrics"},{name:"koel-focus",rawName:"v-koel-focus"}],attrs:{title:"Lyrics",name:"lyrics"},domProps:{value:t.formData.lyrics},on:{input:function(a){a.target.composing||t.$set(t.formData,"lyrics",a.target.value)}}})])]):t._e()])]),t._v(" "),e("footer",[e("btn",{attrs:{type:"submit"}},[t._v("Update")]),t._v(" "),e("btn",{staticClass:"btn-cancel",attrs:{white:""},on:{click:function(a){return a.preventDefault(),t.maybeClose(a)}}},[t._v("Cancel")])],1)])],1)}),[],!1,null,"b91da14a",null);a.default=g.exports}}]);